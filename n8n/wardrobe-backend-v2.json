{
  "name": "Wardrobe Manager Backend API",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "auth/register",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "a1b2c3d4-1111-1111-1111-111111111111",
      "name": "Register Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [260, 300],
      "webhookId": "auth-register"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "auth/login",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "a1b2c3d4-2222-2222-2222-222222222222",
      "name": "Login Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [260, 520],
      "webhookId": "auth-login"
    },
    {
      "parameters": {
        "httpMethod": "GET",
        "path": "auth/me",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "a1b2c3d4-3333-3333-3333-333333333333",
      "name": "Get Me Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [260, 740],
      "webhookId": "auth-me"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "ai/chat",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "a1b2c3d4-4444-4444-4444-444444444444",
      "name": "AI Chat Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [260, 960],
      "webhookId": "ai-chat"
    },
    {
      "parameters": {
        "jsCode": "// Register User Handler\nconst body = $input.first().json.body;\n\n// Validation\nif (!body.email || !body.password) {\n  return [{\n    json: {\n      error: 'Email and password are required',\n      statusCode: 400\n    }\n  }];\n}\n\n// Generate user ID based on email (deterministic)\nconst crypto = require('crypto');\nconst hash = crypto.createHash('md5').update(body.email.toLowerCase()).digest('hex');\nconst userId = 'user_' + hash.substring(0, 12);\n\n// Create tokens\nconst now = Date.now();\nconst accessTokenPayload = {\n  id: userId,\n  email: body.email,\n  type: 'access',\n  iat: now,\n  exp: now + (24 * 60 * 60 * 1000) // 24 hours\n};\n\nconst refreshTokenPayload = {\n  id: userId,\n  type: 'refresh',\n  iat: now,\n  exp: now + (7 * 24 * 60 * 60 * 1000) // 7 days\n};\n\nconst accessToken = Buffer.from(JSON.stringify(accessTokenPayload)).toString('base64');\nconst refreshToken = Buffer.from(JSON.stringify(refreshTokenPayload)).toString('base64');\n\n// Create user object\nconst user = {\n  id: userId,\n  email: body.email,\n  name: body.name || body.email.split('@')[0],\n  gender: body.gender || null,\n  createdAt: new Date().toISOString()\n};\n\nreturn [{\n  json: {\n    user: user,\n    accessToken: accessToken,\n    refreshToken: refreshToken\n  }\n}];"
      },
      "id": "b1b2c3d4-1111-1111-1111-111111111111",
      "name": "Process Register",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [500, 300]
    },
    {
      "parameters": {
        "jsCode": "// Login User Handler\nconst body = $input.first().json.body;\n\n// Validation\nif (!body.email || !body.password) {\n  return [{\n    json: {\n      error: 'Email and password are required',\n      statusCode: 400\n    }\n  }];\n}\n\n// Generate user ID based on email (same as register)\nconst crypto = require('crypto');\nconst hash = crypto.createHash('md5').update(body.email.toLowerCase()).digest('hex');\nconst userId = 'user_' + hash.substring(0, 12);\n\n// Create tokens\nconst now = Date.now();\nconst accessTokenPayload = {\n  id: userId,\n  email: body.email,\n  type: 'access',\n  iat: now,\n  exp: now + (24 * 60 * 60 * 1000)\n};\n\nconst refreshTokenPayload = {\n  id: userId,\n  type: 'refresh',\n  iat: now,\n  exp: now + (7 * 24 * 60 * 60 * 1000)\n};\n\nconst accessToken = Buffer.from(JSON.stringify(accessTokenPayload)).toString('base64');\nconst refreshToken = Buffer.from(JSON.stringify(refreshTokenPayload)).toString('base64');\n\nconst user = {\n  id: userId,\n  email: body.email,\n  name: body.email.split('@')[0]\n};\n\nreturn [{\n  json: {\n    user: user,\n    accessToken: accessToken,\n    refreshToken: refreshToken\n  }\n}];"
      },
      "id": "b1b2c3d4-2222-2222-2222-222222222222",
      "name": "Process Login",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [500, 520]
    },
    {
      "parameters": {
        "jsCode": "// Get Current User from Token\nconst headers = $input.first().json.headers;\nconst authHeader = headers.authorization || headers.Authorization || '';\n\nif (!authHeader || !authHeader.startsWith('Bearer ')) {\n  return [{\n    json: {\n      error: 'Unauthorized',\n      statusCode: 401\n    }\n  }];\n}\n\nconst token = authHeader.replace('Bearer ', '');\n\ntry {\n  const decoded = JSON.parse(Buffer.from(token, 'base64').toString('utf8'));\n  \n  // Check expiration\n  if (decoded.exp && decoded.exp < Date.now()) {\n    return [{\n      json: {\n        error: 'Token expired',\n        statusCode: 401\n      }\n    }];\n  }\n  \n  return [{\n    json: {\n      id: decoded.id,\n      email: decoded.email,\n      name: decoded.email ? decoded.email.split('@')[0] : 'User'\n    }\n  }];\n} catch (e) {\n  return [{\n    json: {\n      error: 'Invalid token',\n      statusCode: 401\n    }\n  }];\n}"
      },
      "id": "b1b2c3d4-3333-3333-3333-333333333333",
      "name": "Process Get Me",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [500, 740]
    },
    {
      "parameters": {
        "jsCode": "// Build AI Prompt\nconst body = $input.first().json.body;\nconst message = body.message || '';\nconst context = body.context || {};\n\nconst systemPrompt = `Ð¢Ð¸ ÑÐ¸ AI ÑÑ‚Ð¸Ð»Ð¸ÑÑ‚ - Ð¿ÐµÑ€ÑÐ¾Ð½Ð°Ð»ÐµÐ½ Ð¼Ð¾Ð´ÐµÐ½ ÐºÐ¾Ð½ÑÑƒÐ»Ñ‚Ð°Ð½Ñ‚ Ð½Ð° Ð±ÑŠÐ»Ð³Ð°Ñ€ÑÐºÐ¸ ÐµÐ·Ð¸Ðº.\n\nÐ¢Ð²Ð¾ÑÑ‚Ð° Ñ€Ð¾Ð»Ñ:\n- ÐŸÐ¾Ð¼Ð°Ð³Ð°Ñˆ Ð½Ð° Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð¸Ñ‚ÐµÐ»Ð¸Ñ‚Ðµ Ð´Ð° Ð¸Ð·Ð±ÐµÑ€Ð°Ñ‚ Ð¿Ð¾Ð´Ñ…Ð¾Ð´ÑÑ‰Ð¸ Ð´Ñ€ÐµÑ…Ð¸ Ð¸ Ñ‚Ð¾Ð°Ð»ÐµÑ‚Ð¸\n- Ð”Ð°Ð²Ð°Ñˆ ÑÑŠÐ²ÐµÑ‚Ð¸ Ð·Ð° ÐºÐ¾Ð¼Ð±Ð¸Ð½Ð¸Ñ€Ð°Ð½Ðµ Ð½Ð° Ñ†Ð²ÐµÑ‚Ð¾Ð²Ðµ Ð¸ ÑÑ‚Ð¸Ð»Ð¾Ð²Ðµ\n- Ð¡ÑŠÐ¾Ð±Ñ€Ð°Ð·ÑÐ²Ð°Ñˆ ÑÐµ Ñ Ð¿Ð¾Ð²Ð¾Ð´Ð°, ÑÐµÐ·Ð¾Ð½Ð° Ð¸ Ð²Ñ€ÐµÐ¼ÐµÑ‚Ð¾\n- ÐŸÑ€ÐµÐ´Ð»Ð°Ð³Ð°Ñˆ Ð¿Ñ€Ð°ÐºÑ‚Ð¸Ñ‡Ð½Ð¸ Ð¸ ÑÑ‚Ð¸Ð»Ð½Ð¸ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ\n\nÐ¢ÐµÐºÑƒÑ‰Ð¾ Ð²Ñ€ÐµÐ¼Ðµ: ${context.weather?.temp || 20}Â°C, ${context.weather?.description || 'ÑƒÐ¼ÐµÑ€ÐµÐ½Ð¾'}\n\nÐžÑ‚Ð³Ð¾Ð²Ð°Ñ€ÑÐ¹ Ð¿Ñ€Ð¸ÑÑ‚ÐµÐ»ÑÐºÐ¸, Ð¸Ð·Ð¿Ð¾Ð»Ð·Ð²Ð°Ð¹ ÐµÐ¼Ð¾Ð´Ð¶Ð¸Ñ‚Ð° Ð·Ð° Ð¿Ð¾-Ð¿Ñ€Ð¸ÑÑ‚ÐµÐ½ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ.\nÐ”Ð°Ð²Ð°Ð¹ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¸ ÑÑŠÐ²ÐµÑ‚Ð¸ Ñ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð¸.`;\n\nreturn [{\n  json: {\n    systemPrompt: systemPrompt,\n    userMessage: message\n  }\n}];"
      },
      "id": "b1b2c3d4-4444-4444-4444-444444444444",
      "name": "Build AI Prompt",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [500, 960]
    },
    {
      "parameters": {
        "model": "gpt-4o-mini",
        "options": {
          "temperature": 0.7,
          "maxTokens": 1000
        }
      },
      "id": "c1b2c3d4-4444-4444-4444-444444444444",
      "name": "OpenAI Chat",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [740, 960]
    },
    {
      "parameters": {
        "jsCode": "// Format AI Response\nconst input = $input.first().json;\n\nlet message = '';\n\n// Handle different response formats from OpenAI node\nif (input.text) {\n  message = input.text;\n} else if (input.message?.content) {\n  message = input.message.content;\n} else if (input.choices && input.choices[0]?.message?.content) {\n  message = input.choices[0].message.content;\n} else if (typeof input === 'string') {\n  message = input;\n} else {\n  // Fallback message\n  message = `Ð—Ð´Ñ€Ð°Ð²ÐµÐ¹Ñ‚Ðµ! ðŸ‘‹ ÐÐ· ÑÑŠÐ¼ Ð²Ð°ÑˆÐ¸ÑÑ‚ AI ÑÑ‚Ð¸Ð»Ð¸ÑÑ‚.\n\nÐœÐ¾Ð³Ð° Ð´Ð° Ð²Ð¸ Ð¿Ð¾Ð¼Ð¾Ð³Ð½Ð° Ñ:\nâ€¢ ðŸ‘” Ð˜Ð·Ð±Ð¾Ñ€ Ð½Ð° Ñ‚Ð¾Ð°Ð»ÐµÑ‚ Ð·Ð° Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð½Ð¸ Ð¿Ð¾Ð²Ð¾Ð´Ð¸\nâ€¢ ðŸŽ¨ ÐšÐ¾Ð¼Ð±Ð¸Ð½Ð¸Ñ€Ð°Ð½Ðµ Ð½Ð° Ñ†Ð²ÐµÑ‚Ð¾Ð²Ðµ\nâ€¢ ðŸŒ¤ï¸ Ð¡ÑŠÐ¾Ð±Ñ€Ð°Ð·ÑÐ²Ð°Ð½Ðµ Ñ Ð²Ñ€ÐµÐ¼ÐµÑ‚Ð¾\nâ€¢ ðŸ’¼ ÐŸÑ€Ð¾Ñ„ÐµÑÐ¸Ð¾Ð½Ð°Ð»ÐµÐ½ dress code\n\nÐšÐ°Ð¶ÐµÑ‚Ðµ Ð¼Ð¸ Ð·Ð° ÐºÐ°ÐºÑŠÐ² Ð¿Ð¾Ð²Ð¾Ð´ Ñ‚ÑŠÑ€ÑÐ¸Ñ‚Ðµ Ð´Ñ€ÐµÑ…Ð¸?`;\n}\n\nreturn [{\n  json: {\n    message: message,\n    sessionId: 'session_' + Date.now()\n  }\n}];"
      },
      "id": "d1b2c3d4-4444-4444-4444-444444444444",
      "name": "Format AI Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [980, 960]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              },
              {
                "name": "Access-Control-Allow-Methods",
                "value": "GET, POST, PUT, DELETE, OPTIONS"
              },
              {
                "name": "Access-Control-Allow-Headers",
                "value": "Content-Type, Authorization"
              }
            ]
          }
        }
      },
      "id": "e1b2c3d4-1111-1111-1111-111111111111",
      "name": "Respond Register",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [740, 300]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              },
              {
                "name": "Access-Control-Allow-Methods",
                "value": "GET, POST, PUT, DELETE, OPTIONS"
              },
              {
                "name": "Access-Control-Allow-Headers",
                "value": "Content-Type, Authorization"
              }
            ]
          }
        }
      },
      "id": "e1b2c3d4-2222-2222-2222-222222222222",
      "name": "Respond Login",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [740, 520]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              },
              {
                "name": "Access-Control-Allow-Methods",
                "value": "GET, POST, PUT, DELETE, OPTIONS"
              },
              {
                "name": "Access-Control-Allow-Headers",
                "value": "Content-Type, Authorization"
              }
            ]
          }
        }
      },
      "id": "e1b2c3d4-3333-3333-3333-333333333333",
      "name": "Respond Me",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [740, 740]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              },
              {
                "name": "Access-Control-Allow-Methods",
                "value": "GET, POST, PUT, DELETE, OPTIONS"
              },
              {
                "name": "Access-Control-Allow-Headers",
                "value": "Content-Type, Authorization"
              }
            ]
          }
        }
      },
      "id": "e1b2c3d4-4444-4444-4444-444444444444",
      "name": "Respond AI Chat",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [1220, 960]
    }
  ],
  "connections": {
    "Register Webhook": {
      "main": [
        [
          {
            "node": "Process Register",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Register": {
      "main": [
        [
          {
            "node": "Respond Register",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Login Webhook": {
      "main": [
        [
          {
            "node": "Process Login",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Login": {
      "main": [
        [
          {
            "node": "Respond Login",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Me Webhook": {
      "main": [
        [
          {
            "node": "Process Get Me",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Get Me": {
      "main": [
        [
          {
            "node": "Respond Me",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Chat Webhook": {
      "main": [
        [
          {
            "node": "Build AI Prompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build AI Prompt": {
      "main": [
        [
          {
            "node": "OpenAI Chat",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat": {
      "main": [
        [
          {
            "node": "Format AI Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format AI Response": {
      "main": [
        [
          {
            "node": "Respond AI Chat",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 4,
  "updatedAt": "2025-12-04T10:00:00.000Z",
  "versionId": "2"
}
