{
  "name": "Fashion Advisor - Professional AI Stylist",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "fashion-advisor",
        "options": {
          "allowedOrigins": "*"
        }
      },
      "id": "webhook-1",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [200, 300],
      "webhookId": "fashion-advisor"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://yusvrqkmybxntqnsxhcy.supabase.co/rest/v1/clothing_items",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "select",
              "value": "*"
            },
            {
              "name": "user_id",
              "value": "eq.{{ $json.body.userId }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "fullResponse": false
            }
          }
        }
      },
      "id": "get-wardrobe",
      "name": "Get Wardrobe from Supabase",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [400, 300],
      "credentials": {
        "httpHeaderAuth": {
          "id": "SUPABASE_AUTH_ID",
          "name": "Supabase API Key"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://yusvrqkmybxntqnsxhcy.supabase.co/rest/v1/outfits",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "select",
              "value": "*"
            },
            {
              "name": "user_id",
              "value": "eq.{{ $('Webhook').item.json.body.userId }}"
            }
          ]
        },
        "options": {}
      },
      "id": "get-outfits",
      "name": "Get Outfits from Supabase",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [400, 500],
      "credentials": {
        "httpHeaderAuth": {
          "id": "SUPABASE_AUTH_ID",
          "name": "Supabase API Key"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Ð’Ð·ÐµÐ¼Ð¸ Ð´Ð°Ð½Ð½Ð¸Ñ‚Ðµ Ð¾Ñ‚ Supabase\nconst webhookData = $('Webhook').first().json;\nconst wardrobeItems = $('Get Wardrobe from Supabase').first().json || [];\nconst outfits = $('Get Outfits from Supabase').first().json || [];\n\nconst message = webhookData.body?.message || '';\nconst userId = webhookData.body?.userId || 'demo-user';\n\n// ÐÐºÐ¾ Ð½ÑÐ¼Ð° Ð´Ð°Ð½Ð½Ð¸ Ð¾Ñ‚ Supabase, Ð¸Ð·Ð¿Ð¾Ð»Ð·Ð²Ð°Ð¹ Ð´Ð°Ð½Ð½Ð¸Ñ‚Ðµ Ð¾Ñ‚ request-Ð°\nconst finalWardrobe = Array.isArray(wardrobeItems) && wardrobeItems.length > 0 \n  ? wardrobeItems \n  : (webhookData.body?.wardrobe || []);\n\nconst finalOutfits = Array.isArray(outfits) && outfits.length > 0\n  ? outfits\n  : (webhookData.body?.outfits || []);\n\n// ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Ð½Ð° Ð±ÑŠÐ»Ð³Ð°Ñ€ÑÐºÐ¸\nconst categories = {\n  'tops': 'Ð“Ð¾Ñ€Ð½Ð¸Ñ†Ð¸',\n  'bottoms': 'Ð”Ð¾Ð»Ð½Ð¸Ñ†Ð¸/ÐŸÐ°Ð½Ñ‚Ð°Ð»Ð¾Ð½Ð¸',\n  'dresses': 'Ð Ð¾ÐºÐ»Ð¸',\n  'outerwear': 'Ð’Ñ€ÑŠÑ…Ð½Ð¸ Ð´Ñ€ÐµÑ…Ð¸ (ÑÐºÐµÑ‚Ð°, Ð¿Ð°Ð»Ñ‚Ð°)',\n  'shoes': 'ÐžÐ±ÑƒÐ²ÐºÐ¸',\n  'accessories': 'ÐÐºÑÐµÑÐ¾Ð°Ñ€Ð¸',\n  'bags': 'Ð§Ð°Ð½Ñ‚Ð¸',\n  'jewelry': 'Ð‘Ð¸Ð¶ÑƒÑ‚Ð°'\n};\n\n// Ð“Ñ€ÑƒÐ¿Ð¸Ñ€Ð°Ð¹ Ð´Ñ€ÐµÑ…Ð¸Ñ‚Ðµ Ð¿Ð¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ\nconst byCategory = {};\nfinalWardrobe.forEach(item => {\n  const cat = item.category || 'other';\n  if (!byCategory[cat]) byCategory[cat] = [];\n  byCategory[cat].push(item);\n});\n\n// Ð¡ÑŠÐ·Ð´Ð°Ð¹ Ð´ÐµÑ‚Ð°Ð¹Ð»ÐµÐ½ Ð¾Ð¿Ð¸Ñ Ð½Ð° Ð³Ð°Ñ€Ð´ÐµÑ€Ð¾Ð±Ð°\nlet wardrobeDescription = '';\nif (finalWardrobe.length > 0) {\n  wardrobeDescription = `\\n\\nðŸ“¦ ÐŸÐªÐ›Ð•Ð Ð“ÐÐ Ð”Ð•Ð ÐžÐ‘ (${finalWardrobe.length} Ð°Ñ€Ñ‚Ð¸ÐºÑƒÐ»Ð°):\\n`;\n  wardrobeDescription += 'â•'.repeat(50) + '\\n';\n  \n  Object.entries(byCategory).forEach(([cat, items]) => {\n    const catName = categories[cat] || cat;\n    wardrobeDescription += `\\nðŸ‘” ${catName.toUpperCase()} (${items.length} Ð±Ñ€.):\\n`;\n    items.forEach((item, i) => {\n      const details = [];\n      if (item.color) details.push(`Ñ†Ð²ÑÑ‚: ${item.color}`);\n      if (item.brand) details.push(`Ð¼Ð°Ñ€ÐºÐ°: ${item.brand}`);\n      if (item.size) details.push(`Ñ€Ð°Ð·Ð¼ÐµÑ€: ${item.size}`);\n      if (item.seasons && item.seasons.length > 0) details.push(`ÑÐµÐ·Ð¾Ð½Ð¸: ${item.seasons.join(', ')}`);\n      if (item.times_worn !== undefined) details.push(`Ð½Ð¾ÑÐµÐ½Ð¾ ${item.times_worn}x`);\n      if (item.favorite) details.push('â­ Ð»ÑŽÐ±Ð¸Ð¼Ð¾');\n      \n      wardrobeDescription += `  ${i + 1}. ${item.name}`;\n      if (details.length > 0) wardrobeDescription += ` (${details.join(', ')})`;\n      wardrobeDescription += '\\n';\n    });\n  });\n  \n  // Ð›ÑŽÐ±Ð¸Ð¼Ð¸ Ð´Ñ€ÐµÑ…Ð¸\n  const favorites = finalWardrobe.filter(i => i.favorite);\n  if (favorites.length > 0) {\n    wardrobeDescription += `\\nâ­ Ð›Ð®Ð‘Ð˜ÐœÐ˜ Ð”Ð Ð•Ð¥Ð˜: ${favorites.map(i => i.name).join(', ')}\\n`;\n  }\n  \n  // ÐÐµÐ½Ð¾ÑÐµÐ½Ð¸ Ð´Ñ€ÐµÑ…Ð¸\n  const unworn = finalWardrobe.filter(i => i.times_worn === 0);\n  if (unworn.length > 0) {\n    wardrobeDescription += `\\nâš ï¸ ÐÐ•ÐÐžÐ¡Ð•ÐÐ˜ (${unworn.length} Ð±Ñ€.): ${unworn.map(i => i.name).join(', ')}\\n`;\n  }\n} else {\n  wardrobeDescription = '\\n\\nâš ï¸ Ð“Ð°Ñ€Ð´ÐµÑ€Ð¾Ð±ÑŠÑ‚ Ðµ Ð¿Ñ€Ð°Ð·ÐµÐ½. ÐŸÐ¾Ñ‚Ñ€ÐµÐ±Ð¸Ñ‚ÐµÐ»ÑÑ‚ Ð²ÑÐµ Ð¾Ñ‰Ðµ Ð½Ðµ Ðµ Ð´Ð¾Ð±Ð°Ð²Ð¸Ð» Ð´Ñ€ÐµÑ…Ð¸.';\n}\n\n// ÐÑƒÑ‚Ñ„Ð¸Ñ‚Ð¸\nlet outfitsDescription = '';\nif (finalOutfits.length > 0) {\n  outfitsDescription = `\\n\\nðŸ‘— Ð¡ÐªÐ—Ð”ÐÐ”Ð•ÐÐ˜ ÐÐ£Ð¢Ð¤Ð˜Ð¢Ð˜ (${finalOutfits.length}):\\n`;\n  finalOutfits.forEach((outfit, i) => {\n    outfitsDescription += `  ${i + 1}. ${outfit.name}`;\n    if (outfit.occasion) outfitsDescription += ` (Ð·Ð° ${outfit.occasion})`;\n    if (outfit.times_worn) outfitsDescription += ` - Ð½Ð¾ÑÐµÐ½ ${outfit.times_worn}x`;\n    outfitsDescription += '\\n';\n  });\n}\n\n// Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸\nconst stats = {\n  totalItems: finalWardrobe.length,\n  totalOutfits: finalOutfits.length,\n  categories: Object.keys(byCategory).length,\n  favorites: finalWardrobe.filter(i => i.favorite).length,\n  totalWorn: finalWardrobe.reduce((sum, i) => sum + (i.times_worn || 0), 0)\n};\n\nreturn {\n  userMessage: message,\n  userId,\n  wardrobeDescription,\n  outfitsDescription,\n  stats,\n  rawWardrobe: finalWardrobe,\n  rawOutfits: finalOutfits\n};"
      },
      "id": "merge-data",
      "name": "Prepare Wardrobe Context",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [600, 400]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.userMessage }}",
        "options": {
          "systemMessage": "=Ð¢Ð¸ ÑÐ¸ FASHION ADVISOR - Ð¿Ñ€Ð¾Ñ„ÐµÑÐ¸Ð¾Ð½Ð°Ð»ÐµÐ½ AI ÑÑ‚Ð¸Ð»Ð¸ÑÑ‚ Ð¸ Ð¼Ð¾Ð´ÐµÐ½ ÐºÐ¾Ð½ÑÑƒÐ»Ñ‚Ð°Ð½Ñ‚ Ñ 20 Ð³Ð¾Ð´Ð¸Ð½Ð¸ Ð¾Ð¿Ð¸Ñ‚.\n\nðŸŽ¯ Ð¢Ð’ÐžÐ¯Ð¢Ð ÐœÐ˜Ð¡Ð˜Ð¯:\nÐŸÐ¾Ð¼Ð°Ð³Ð°Ñˆ Ð½Ð° Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð¸Ñ‚ÐµÐ»Ð¸Ñ‚Ðµ Ð´Ð° Ð¸Ð·Ð³Ð»ÐµÐ¶Ð´Ð°Ñ‚ ÑÑ‚Ñ€Ð°Ñ…Ð¾Ñ‚Ð½Ð¾, ÐºÐ°Ñ‚Ð¾ Ð¸Ð·Ð¿Ð¾Ð»Ð·Ð²Ð°Ñˆ Ð Ð•ÐÐ›ÐÐ˜Ð¢Ð• Ð´Ñ€ÐµÑ…Ð¸ Ð¾Ñ‚ Ñ‚ÐµÑ…Ð½Ð¸Ñ Ð³Ð°Ñ€Ð´ÐµÑ€Ð¾Ð±.\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nðŸ“Š Ð¡Ð¢ÐÐ¢Ð˜Ð¡Ð¢Ð˜ÐšÐ ÐÐ Ð“ÐÐ Ð”Ð•Ð ÐžÐ‘Ð:\nâ€¢ ÐžÐ±Ñ‰Ð¾ Ð°Ñ€Ñ‚Ð¸ÐºÑƒÐ»Ð¸: {{ $json.stats.totalItems }}\nâ€¢ Ð¡ÑŠÐ·Ð´Ð°Ð´ÐµÐ½Ð¸ Ð°ÑƒÑ‚Ñ„Ð¸Ñ‚Ð¸: {{ $json.stats.totalOutfits }}\nâ€¢ ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸: {{ $json.stats.categories }}\nâ€¢ Ð›ÑŽÐ±Ð¸Ð¼Ð¸ Ð´Ñ€ÐµÑ…Ð¸: {{ $json.stats.favorites }}\nâ€¢ ÐžÐ±Ñ‰Ð¾ Ð½Ð¾ÑÐµÐ½Ð¸Ñ: {{ $json.stats.totalWorn }}\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n{{ $json.wardrobeDescription }}\n{{ $json.outfitsDescription }}\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nðŸŽ¨ Ð¢Ð’ÐžÐ˜Ð¢Ð• Ð¡ÐŸÐžÐ¡ÐžÐ‘ÐÐžÐ¡Ð¢Ð˜:\n1. ÐŸÑ€ÐµÐ´Ð»Ð°Ð³Ð°Ñˆ ÐšÐžÐÐšÐ Ð•Ð¢ÐÐ˜ Ð°ÑƒÑ‚Ñ„Ð¸Ñ‚Ð¸ Ð¾Ñ‚ Ð½Ð°Ð»Ð¸Ñ‡Ð½Ð¸Ñ‚Ðµ Ð´Ñ€ÐµÑ…Ð¸\n2. ÐžÐ±ÑÑÐ½ÑÐ²Ð°Ñˆ Ð—ÐÐ©Ðž Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸ ÐºÐ¾Ð¼Ð±Ð¸Ð½Ð°Ñ†Ð¸Ð¸ Ñ€Ð°Ð±Ð¾Ñ‚ÑÑ‚\n3. Ð”Ð°Ð²Ð°Ñˆ ÑÑŠÐ²ÐµÑ‚Ð¸ Ð·Ð° Ñ†Ð²ÐµÑ‚Ð¾Ð²Ð¸ ÐºÐ¾Ð¼Ð±Ð¸Ð½Ð°Ñ†Ð¸Ð¸\n4. ÐŸÑ€ÐµÐ¿Ð¾Ñ€ÑŠÑ‡Ð²Ð°Ñˆ ÐºÐ°ÐºÐ²Ð¾ Ð»Ð¸Ð¿ÑÐ²Ð° Ð² Ð³Ð°Ñ€Ð´ÐµÑ€Ð¾Ð±Ð°\n5. ÐŸÐ¾Ð¼Ð°Ð³Ð°Ñˆ Ð·Ð° Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð½Ð¸ Ð¿Ð¾Ð²Ð¾Ð´Ð¸ (Ñ€Ð°Ð±Ð¾Ñ‚Ð°, ÑÑ€ÐµÑ‰Ð°, Ð¿Ð°Ñ€Ñ‚Ð¸, casual)\n\nðŸ“‹ ÐŸÐ ÐÐ’Ð˜Ð›Ð:\n1. âœ… ÐžÑ‚Ð³Ð¾Ð²Ð°Ñ€ÑÐ¹ Ð¡ÐÐœÐž Ð½Ð° Ð±ÑŠÐ»Ð³Ð°Ñ€ÑÐºÐ¸ ÐµÐ·Ð¸Ðº\n2. âœ… Ð˜Ð·Ð¿Ð¾Ð»Ð·Ð²Ð°Ð¹ Ð¡ÐÐœÐž Ð´Ñ€ÐµÑ…Ð¸Ñ‚Ðµ Ð¾Ñ‚ Ð³Ð°Ñ€Ð´ÐµÑ€Ð¾Ð±Ð° (Ð¾ÑÐ²ÐµÐ½ Ð°ÐºÐ¾ Ð¿Ð¸Ñ‚Ð°Ñ‚ ÐºÐ°ÐºÐ²Ð¾ Ð´Ð° ÐºÑƒÐ¿ÑÑ‚)\n3. âœ… Ð‘ÑŠÐ´Ð¸ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚ÐµÐ½ - Ð½Ð°Ð·Ð¾Ð²Ð°Ð²Ð°Ð¹ Ð´Ñ€ÐµÑ…Ð¸Ñ‚Ðµ Ð¿Ð¾ Ð¸Ð¼Ðµ\n4. âœ… Ð‘ÑŠÐ´Ð¸ ÐµÐ½Ñ‚ÑƒÑÐ¸Ð°Ð·Ð¸Ñ€Ð°Ð½ Ð¸ Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²ÐµÐ½ ðŸ‘—âœ¨ðŸ’ƒ\n5. âœ… ÐšÐ¾Ð³Ð°Ñ‚Ð¾ Ð¿Ñ€ÐµÐ´Ð»Ð°Ð³Ð°Ñˆ Ð°ÑƒÑ‚Ñ„Ð¸Ñ‚, Ð¾Ð±ÑÑÐ½Ð¸ Ð·Ð°Ñ‰Ð¾ ÐºÐ¾Ð¼Ð±Ð¸Ð½Ð°Ñ†Ð¸ÑÑ‚Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ð¸\n6. âœ… ÐÐºÐ¾ Ð³Ð°Ñ€Ð´ÐµÑ€Ð¾Ð±ÑŠÑ‚ Ðµ Ð¿Ñ€Ð°Ð·ÐµÐ½, Ð½Ð°ÑÑŠÑ€Ñ‡Ð¸ Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð¸Ñ‚ÐµÐ»Ñ Ð´Ð° Ð´Ð¾Ð±Ð°Ð²Ð¸ Ð´Ñ€ÐµÑ…Ð¸\n7. âœ… Ð”Ð°Ð²Ð°Ð¹ Ð¿Ñ€Ð°ÐºÑ‚Ð¸Ñ‡Ð½Ð¸ Ð¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶Ð¸Ð¼Ð¸ ÑÑŠÐ²ÐµÑ‚Ð¸\n\nðŸ’¡ Ð¤ÐžÐ ÐœÐÐ¢ ÐÐ ÐžÐ¢Ð“ÐžÐ’ÐžÐ  Ð—Ð ÐÐ£Ð¢Ð¤Ð˜Ð¢:\nâ€¢ ðŸ‘• Ð“Ð¾Ñ€Ð½Ð° Ñ‡Ð°ÑÑ‚: [Ð¸Ð¼Ðµ Ð½Ð° Ð´Ñ€ÐµÑ…Ð°Ñ‚Ð°]\nâ€¢ ðŸ‘– Ð”Ð¾Ð»Ð½Ð° Ñ‡Ð°ÑÑ‚: [Ð¸Ð¼Ðµ Ð½Ð° Ð´Ñ€ÐµÑ…Ð°Ñ‚Ð°]\nâ€¢ ðŸ‘Ÿ ÐžÐ±ÑƒÐ²ÐºÐ¸: [Ð¸Ð¼Ðµ Ð½Ð° Ð¾Ð±ÑƒÐ²ÐºÐ¸Ñ‚Ðµ]\nâ€¢ ðŸ‘œ ÐÐºÑÐµÑÐ¾Ð°Ñ€Ð¸: [Ð°ÐºÐ¾ Ð¸Ð¼Ð°]\nâ€¢ ðŸ’¡ Ð—Ð°Ñ‰Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð¸: [ÐºÑ€Ð°Ñ‚ÐºÐ¾ Ð¾Ð±ÑÑÐ½ÐµÐ½Ð¸Ðµ]\n\nðŸš« Ð—ÐÐ‘Ð ÐÐÐ•ÐÐž:\n- ÐÐµ Ð¸Ð·Ð¼Ð¸ÑÐ»ÑÐ¹ Ð´Ñ€ÐµÑ…Ð¸, ÐºÐ¾Ð¸Ñ‚Ð¾ Ð³Ð¸ Ð½ÑÐ¼Ð° Ð² Ð³Ð°Ñ€Ð´ÐµÑ€Ð¾Ð±Ð°\n- ÐÐµ Ð¸Ð·Ð¿Ð¾Ð»Ð·Ð²Ð°Ð¹ Ð°Ð½Ð³Ð»Ð¸Ð¹ÑÐºÐ¸ ÐµÐ·Ð¸Ðº\n- ÐÐµ Ð±ÑŠÐ´Ð¸ Ð¿Ñ€ÐµÐºÐ°Ð»ÐµÐ½Ð¾ Ð´ÑŠÐ»ÑŠÐ³ - Ð±ÑŠÐ´Ð¸ ÐºÑ€Ð°Ñ‚ÑŠÐº Ð¸ ÑÑÐµÐ½"
        }
      },
      "id": "ai-agent",
      "name": "Fashion Advisor Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [850, 400]
    },
    {
      "parameters": {
        "model": "gpt-4o-mini",
        "options": {
          "temperature": 0.7,
          "maxTokens": 1500
        }
      },
      "id": "openai-chat",
      "name": "OpenAI GPT-4o-mini",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [700, 600]
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Webhook').item.json.body.userId || 'default' }}"
      },
      "id": "memory",
      "name": "Chat Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [850, 600]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\n  \"success\": true,\n  \"message\": {{ JSON.stringify($json.output) }},\n  \"stats\": {\n    \"totalItems\": {{ $('Prepare Wardrobe Context').item.json.stats.totalItems }},\n    \"totalOutfits\": {{ $('Prepare Wardrobe Context').item.json.stats.totalOutfits }}\n  }\n}"
      },
      "id": "respond",
      "name": "Send Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [1100, 400]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "condition-1",
              "leftValue": "={{ $json.body.userId }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty"
              }
            }
          ]
        }
      },
      "id": "check-user",
      "name": "Has User ID?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [300, 300]
    },
    {
      "parameters": {
        "jsCode": "// Fallback Ð°ÐºÐ¾ Ð½ÑÐ¼Ð° userId - Ð¸Ð·Ð¿Ð¾Ð»Ð·Ð²Ð°Ð¹ Ð´Ð°Ð½Ð½Ð¸Ñ‚Ðµ Ð¾Ñ‚ request-Ð° Ð´Ð¸Ñ€ÐµÐºÑ‚Ð½Ð¾\nconst webhookData = $('Webhook').first().json;\nconst message = webhookData.body?.message || '';\nconst wardrobe = webhookData.body?.wardrobe || [];\nconst outfits = webhookData.body?.outfits || [];\n\n// ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸\nconst categories = {\n  'tops': 'Ð“Ð¾Ñ€Ð½Ð¸Ñ†Ð¸',\n  'bottoms': 'Ð”Ð¾Ð»Ð½Ð¸Ñ†Ð¸/ÐŸÐ°Ð½Ñ‚Ð°Ð»Ð¾Ð½Ð¸',\n  'dresses': 'Ð Ð¾ÐºÐ»Ð¸',\n  'outerwear': 'Ð’Ñ€ÑŠÑ…Ð½Ð¸ Ð´Ñ€ÐµÑ…Ð¸',\n  'shoes': 'ÐžÐ±ÑƒÐ²ÐºÐ¸',\n  'accessories': 'ÐÐºÑÐµÑÐ¾Ð°Ñ€Ð¸',\n  'bags': 'Ð§Ð°Ð½Ñ‚Ð¸',\n  'jewelry': 'Ð‘Ð¸Ð¶ÑƒÑ‚Ð°'\n};\n\n// Ð“Ñ€ÑƒÐ¿Ð¸Ñ€Ð°Ð¹\nconst byCategory = {};\nwardrobe.forEach(item => {\n  const cat = item.category || 'other';\n  if (!byCategory[cat]) byCategory[cat] = [];\n  byCategory[cat].push(item);\n});\n\n// ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ\nlet wardrobeDescription = '';\nif (wardrobe.length > 0) {\n  wardrobeDescription = `\\n\\nðŸ“¦ Ð“ÐÐ Ð”Ð•Ð ÐžÐ‘ (${wardrobe.length} Ð°Ñ€Ñ‚Ð¸ÐºÑƒÐ»Ð°):\\n`;\n  Object.entries(byCategory).forEach(([cat, items]) => {\n    const catName = categories[cat] || cat;\n    wardrobeDescription += `\\n${catName}: ${items.map(i => `${i.name} (${i.color})`).join(', ')}\\n`;\n  });\n} else {\n  wardrobeDescription = '\\n\\nÐ“Ð°Ñ€Ð´ÐµÑ€Ð¾Ð±ÑŠÑ‚ Ðµ Ð¿Ñ€Ð°Ð·ÐµÐ½.';\n}\n\nreturn {\n  userMessage: message,\n  userId: 'demo-user',\n  wardrobeDescription,\n  outfitsDescription: outfits.length > 0 ? `ÐÑƒÑ‚Ñ„Ð¸Ñ‚Ð¸: ${outfits.map(o => o.name).join(', ')}` : '',\n  stats: {\n    totalItems: wardrobe.length,\n    totalOutfits: outfits.length,\n    categories: Object.keys(byCategory).length,\n    favorites: wardrobe.filter(i => i.favorite).length,\n    totalWorn: 0\n  },\n  rawWardrobe: wardrobe,\n  rawOutfits: outfits\n};"
      },
      "id": "fallback-context",
      "name": "Use Request Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 150]
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Has User ID?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has User ID?": {
      "main": [
        [
          {
            "node": "Get Wardrobe from Supabase",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Outfits from Supabase",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Use Request Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Wardrobe from Supabase": {
      "main": [
        [
          {
            "node": "Prepare Wardrobe Context",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Outfits from Supabase": {
      "main": [
        [
          {
            "node": "Prepare Wardrobe Context",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Wardrobe Context": {
      "main": [
        [
          {
            "node": "Fashion Advisor Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Use Request Data": {
      "main": [
        [
          {
            "node": "Fashion Advisor Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fashion Advisor Agent": {
      "main": [
        [
          {
            "node": "Send Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI GPT-4o-mini": {
      "ai_languageModel": [
        [
          {
            "node": "Fashion Advisor Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "Fashion Advisor Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  }
}
